# ============================================================================
# CONFIGURACIÓN DE RENDER - CLÍNICA DENTAL BACKEND
# ============================================================================
# Este archivo define la infraestructura como código para Render
# ============================================================================

services:
  # ============================================================================
  # WEB SERVICE - Backend Django
  # ============================================================================
  - type: web
    name: clinica-dental-backend
    env: python
    region: oregon # Puedes cambiar a: oregon, frankfurt, singapore
    plan: free # Opciones: free, starter, standard, pro
    
    # Build configuration
    buildCommand: "bash build.sh"
    startCommand: "gunicorn core.wsgi:application"
    
    # Environment variables
    envVars:
      - key: PYTHON_VERSION
        value: 3.11.9
      
      - key: DEBUG
        value: false
      
      - key: SECRET_KEY
        generateValue: true  # Render generará una clave secreta automáticamente
      
      - key: ALLOWED_HOSTS
        value: .onrender.com
      
      - key: CORS_ALLOWED_ORIGINS
        value: https://tu-frontend.vercel.app,https://tu-frontend.netlify.app
      
      - key: CSRF_TRUSTED_ORIGINS
        value: https://tu-frontend.vercel.app,https://clinica-dental-backend.onrender.com
      
      # Database (OPCIÓN A: Conectar a BD existente)
      # Copia la Internal Database URL de tu PostgreSQL existente
      - key: DATABASE_URL
        value: postgresql://usuario:password@host.oregon-postgres.render.com/nombre_bd
      
      # OPCIÓN B: Si quieres crear BD nueva (solo si eliminaste la anterior)
      # - key: DATABASE_URL
      #   fromDatabase:
      #     name: clinica-dental-db
      #     property: connectionString
      
      # Variables personalizadas
      - key: DEFAULT_TENANT_SCHEMA
        value: clinica_demo
      
      - key: DEFAULT_TENANT_DOMAIN
        value: clinica-demo
    
    # Health check
    healthCheckPath: /api/
    
    # Autoscaling (solo en planes pagos)
    # autoDeploy: true
    # numInstances: 1

  # ============================================================================
  # DATABASE - PostgreSQL
  # ============================================================================
databases:
  - name: clinica-dental-db
    databaseName: clinica_dental_prod
    user: clinica_user
    region: oregon # Debe ser la misma región que el web service
    plan: free # Opciones: free, starter, standard, pro
    
    # Configuración de PostgreSQL
    postgresMajorVersion: 16
    
    # Respaldo automático (solo en planes pagos)
    # ipAllowList: []  # Vacío = permite todas las IPs
